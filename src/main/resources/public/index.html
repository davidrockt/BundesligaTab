<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bundesliga Tabelle</title>
    <style>
        .datagrid table {
            border-collapse: collapse; text-align: left; width: 500px; }
        .datagrid {font: normal 12px/150% Arial, Helvetica, sans-serif;
            background: #fff; overflow: hidden; }
        .datagrid table td, .datagrid table th { padding: 3px 10px; }
        .datagrid table thead th { /*background:-moz-linear-gradient( center top, #006699 5%, #0B2A7F 100% );*/
            filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#006699', endColorstr='#0B2A7F');
            background: #006699;
            color:#FFD561; font-size: 15px;
            font-weight: bold; border-left: 1px solid #FFFFFF; }
        .datagrid table thead th:first-child { border: none; }
        .datagrid table tbody td { color: #00496B; border-left: 1px solid #E1EEF4;font-size: 12px;border-bottom: 1px solid #A5AEB3;font-weight: normal; }
        .datagrid table tbody .alt td { background: #EBF9FF; color: #00496B; }
        .datagrid table tbody td:first-child { border-left: none; }
        .datagrid table tbody tr:last-child td { border-bottom: none; }
        .datagrid table tfoot td div { border-top: 1px solid #006699;background: #E1EEF4;}
        .datagrid table tfoot td { padding: 0; font-size: 12px }
        .datagrid table tfoot td div{ padding: 3px; }
    </style>
</head>
<body onload="loadTable()">
<div class="datagrid"><table id="table">
    <!-- Hier kommt der Tabelleninhalt hin

    <thead>
        <tr>
            <th></th> <th>Spiele</th> <th>Gewonnen</th> <th>Tore</th> <th>Punkte</th>
        </tr>
    </thead>
    <tfoot>
        <tr>
            <td colspan="5"><div>&nbsp;</div>
        </tr>
    </tfoot>
    <tbody>
        <tr>
            <td>1</td> <td>data</td> <td>data</td> <td>data</td> <td></td>
        </tr>
        <tr class="alt">
            <td>2</td> <td>data</td> <td>data</td> <td></td> <td></td>
        </tr>
        <tr>
            <td>3</td> <td>data</td> <td>data</td> <td>data</td> <td></td>
        </tr>
        <tr class="alt">
            <td>4</td> <td>data</td> <td>data</td> <td>data</td> <td></td>
        </tr>
    </tbody>

    Ende Tabelleninhalt -->
</table></div>
<form id="addgame">
    <label>FÃ¼ge neues Spiel hinzu:
        <select name="country1" id="country1">
            <option value="de">Deutschland</option>
            <option value="gb">England</option>
            <option value="es">Spanien</option>
            <option value="br">Brasilien</option>
        </select>
        <select name="country2" id="country2">
            <option value="br">Brasilien</option>
            <option value="gb">England</option>
            <option value="de">Deutschland</option>
            <option value="es">Spanien</option>
        </select>
        Tore:
        <input id="goals1" type="number" value="2">
         :
        <input id="goals2" type="number" value="1">
        <input type="button" onclick="sendAndClear()" value="FERTIG!">
    </label>
</form>
<!-- <button onclick="loadTable()">Do Something</button> -->
</body>

<script type="text/javascript">
    var http = new XMLHttpRequest();

    function sendRequestGET(path, query) {
        console.log('path = ' + path);
        http.open('GET', path + '?' + query);
        http.send();
    }

    http.onreadystatechange = function() {
        if (this.readyState === 4 && this.status === 200) {
            document.getElementById('table').innerHTML = this.responseText;
        }
    };

    function loadTable() {
        sendRequestGET('start');
    }

    function addGame() {

        sendRequestGET('addgame', 'country1=' + document.getElementById('country1').value +
                        '&country2=' + document.getElementById('country2').value +
                        '&goals1=' + document.getElementById('goals1').value +
                        '&goals2=' + document.getElementById('goals2').value);
    }

    // Kopie von https://javalin.io/tutorials/websocket-example
    //
    //
    // small helper function for selecting element by id
    let id = id => document.getElementById(id);

    //Establish the WebSocket connection and set up event handlers
    let ws = new WebSocket("ws://" + location.hostname + ":" + location.port + "/livematch");
    ws.onmessage = msg => updateTable(msg);
    ws.onclose = () => alert("WebSocket connection closed");

    // Add event listeners to button and input field
    //id("send").addEventListener("click", () => sendAndClear(id("message").value));
    /*
    id("message").addEventListener("keypress", function (e) {
        if (e.code === "0x24") { // Send message if enter is pressed in input field
            sendAndClear(e.target.value);
        }
    });
    */

    function sendAndClear(message) {
        var json = JSON.stringify({'country1': document.getElementById('country1').value,
            'country2': document.getElementById('country2').value,
            'goals1': document.getElementById('goals1').value,
            'goals2': document.getElementById('goals2').value});
        console.log(json);
        if (message !== "") {
            ws.send(JSON.stringify(json));
            //id("message").value = "";
        }
    }

    function updateTable(msg) { // Update chat-panel and list of connected users
        //let data = JSON.parse(msg.data);
        console.log("updateTable");
        console.log(msg);
        // id("table").insertAdjacentHTML("afterbegin", data.userMessage);
        // id("userlist").innerHTML = data.userlist.map(user => "<li>" + user + "</li>").join("");
        document.getElementById('table').innerHTML = msg.data;
    }
    //
    //
    // Kopie Ende

</script>
</html>

